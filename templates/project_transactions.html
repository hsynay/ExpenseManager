{% extends "base.html" %}

{% block title %}{{ project_name }} - Kasa Defteri{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="fw-bold mb-0"><i class="fa-solid fa-book me-2 text-primary"></i>Kasa Defteri</h2>
        <p class="text-muted fs-5">{{ project_name }}</p>
    </div>
    <div>
        <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">
            <i class="fa-solid fa-arrow-left me-1"></i>Geri
        </a>
    </div>
</div>

<form method="get" class="mb-4">
    <div class="row g-2 align-items-center">
        <div class="col-md-4">
            <label class="form-label fw-bold mb-1">Görüntüle:</label>
            <select name="view" class="form-select" onchange="this.form.submit()">
                <option value="all" {% if view_type == 'all' %}selected{% endif %}>Tümü (Gerçekleşen Gelir ve Giderler)</option>
                <option value="income" {% if view_type == 'income' %}selected{% endif %}>Sadece Gelirler</option>
                <option value="expense" {% if view_type == 'expense' %}selected{% endif %}>Sadece Giderler</option>
            </select>
        </div>
    </div>
</form>

{% if view_type in ['all', 'income'] %}
<div class="card mb-4">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0"><i class="fa-solid fa-arrow-down me-2"></i>Gerçekleşen Gelirler</h5>
    </div>
    <div class="card-body table-responsive p-0">
        <table class="table table-striped table-hover table-sm mb-0">
            <thead>
                <tr>
                    <th>Tarih</th>
                    <th>Kimden</th>
                    <th>Daire</th>
                    <th>Açıklama</th>
                    <th>Yöntem</th>
                    <th class="text-end">Tutar</th>
                </tr>
            </thead>
            <tbody>
                {% for date, desc, amount, method, first, last, block, floor, flat_no in income_data %}
                <tr>
                    <td>{{ date.strftime('%d.%m.%Y') }}</td>
                    <td>{{ (first or '') ~ ' ' ~ (last or '') }}</td>
                    <td>Blok: {{ block or 'N/A' }}, Kat: {{ floor }}, No: {{ flat_no }}</td>
                    <td>{{ desc or '-' }}</td>
                    <td>
                        {% if method == 'çek' %}
                            <span class="badge bg-info text-dark"><i class="fa-solid fa-money-check-dollar me-1"></i> Çek</span>
                        {% else %}
                            <span class="badge bg-success"><i class="fa-solid fa-money-bill me-1"></i> Nakit</span>
                        {% endif %}
                    </td>
                    <td class="text-end text-success fw-bold">{{ amount|thousands }} ₺</td>
                </tr>
                {% else %}
                <tr><td colspan="6" class="text-center text-muted p-3">Bu projeye ait gelir kaydı yok.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

{% if view_type in ['all', 'expense'] %}
<div class="card">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0"><i class="fa-solid fa-arrow-up me-2"></i>Gerçekleşen Giderler</h5>
    </div>
    <div class="card-body table-responsive p-0">
        <table class="table table-striped table-hover table-sm mb-0">
            <thead>
                <tr>
                    <th>Tarih</th>
                    <th>Başlık / Açıklama</th>
                    <th>Kime / Nereye</th>
                    <th>Yöntem</th>
                    <th class="text-end">Tutar</th>
                </tr>
            </thead>
            <tbody>
                {% for date, title, party_name, description, method, amount, type in expense_data %}
                <tr>
                    <td>{{ date.strftime('%d.%m.%Y') }}</td>
                    <td>
                        <div class="fw-bold">{{ title }}</div>
                        <div class="text-muted small">{{ description or '-' }}</div>
                    </td>
                    <td>
                        <div class="fw-bold">{{ party_name or '-' }}</div>
                        <div class="text-muted small">{{ type }}</div>
                    </td>
                    <td>
                        {% if method == 'çek' %}
                            <span class="badge bg-info text-dark"><i class="fa-solid fa-money-check-dollar me-1"></i> Çek</span>
                        {% else %}
                            <span class="badge bg-danger"><i class="fa-solid fa-money-bill me-1"></i> Nakit</span>
                        {% endif %}
                    </td>
                    <td class="text-end text-danger fw-bold">{{ amount|thousands }} ₺</td>
                </tr>
                {% else %}
                <tr><td colspan="5" class="text-center text-muted p-3">Bu projeye ait gider kaydı yok.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}
{% endblock %}