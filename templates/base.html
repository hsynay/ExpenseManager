<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}KONAK İnşaat{% endblock %}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">

    {% block extra_head %}{% endblock %}
</head>
<body>
    <!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark fixed-top shadow">
    <div class="container">
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'dashboard' %}active{% endif %}" href="{{ url_for('dashboard') }}"><i class="fa-solid fa-home me-1"></i>Ana Sayfa</a>
                </li>
                <li class="nav-item mx-3"></li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle {% if request.endpoint in ['new_payment', 'list_payments', 'debt_status', 'select_project_for_expenses'] %}active{% endif %}" href="#" id="financialDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fa-solid fa-coins me-1"></i> Finansal
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="financialDropdown">
                        <li><a class="dropdown-item" href="{{ url_for('assign_flat_owner') }}">Daire Satış Kaydı</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('new_payment') }}">Yeni Gelir Kaydet</a></li>
                    </ul>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle {% if request.endpoint in ['new_payment', 'list_payments', 'debt_status', 'select_project_for_expenses'] %}active{% endif %}" href="#" id="financialDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fa-solid fa-list me-1"></i> Muhasebe
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="financialDropdown">
                        <li><a class="dropdown-item" href="{{ url_for('debt_status') }}">Gelir Muhasebe İşlemleri</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('list_expenses') }}">Gider Muhasebe İşlemleri</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="{{ url_for('list_checks') }}">Çek Takibi</a></li>
                    </ul>
                </li>
                
                <!--
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle {% if request.endpoint in ['list_customers'] %}active{% endif %}" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fa-solid fa-users-cog me-1"></i> Yönetim
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="adminDropdown">
                        <li><a class="dropdown-item" href="{{ url_for('list_customers') }}">Müşteriler</a></li>
                    </ul>
                </li>
                -->

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle {% if request.endpoint in ['reports', 'select_project_for_coop_report'] %}active{% endif %}" href="#" id="reportsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false"><i class="fa-solid fa-chart-pie me-1"></i> Raporlar</a>
                    <ul class="dropdown-menu" aria-labelledby="reportsDropdown">
                        <li><a class="dropdown-item" href="{{ url_for('reports') }}">Proje Raporları</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('select_project_for_coop_report') }}">Kooperatif Aylık Raporu</a></li>
                        </ul>
                </li>

            </ul>
            <div class="d-flex align-items-center">
                {% if session.user_name %}
                <span class="me-3 text-white"><i class="fa-solid fa-user me-1"></i>{{ session.user_name }}</span>
                <a href="{{ url_for('logout') }}" class="btn btn-danger btn-sm"><i class="fa-solid fa-sign-out-alt me-1"></i>Çıkış</a>
                {% endif %}
            </div>
        </div>
    </div>
</nav>


    <!-- Main Content -->
    <div class="container my-5">
        {% block content %}{% endblock %}
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    {% block scripts %}{% endblock %}

    <script>
        
    // thousands-input: gösterimde nokta ile binlik ayır, ondalıkta virgül
    (function(){
        function parseNumberString(s){
            if(s === null || s === undefined) return NaN;
            s = String(s).trim();
            if(s === '') return NaN;
            // If both separators present assume dot = thousands, comma = decimal
            if(s.indexOf('.') > -1 && s.indexOf(',') > -1){
                s = s.replace(/\./g,'').replace(/,/g,'.');
                return Number(s);
            }
            // Remove dots that look like thousands separators: dot followed by groups of 3 digits
            s = s.replace(/\.(?=\d{3}(?:\.|,|$))/g, '');
            // replace comma with dot to normalize decimal separator
            s = s.replace(/,/g, '.');
            return Number(s);
        }

        function toDisplay(value){
            if(value === null || value === undefined || value === '') return '';
            var num = parseNumberString(value);
            if(isNaN(num)) return value;
            var parts = num.toFixed(2).split('.');
            parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            // if fractional is .00, show only integer part
            if(parts[1] === '00') return parts[0];
            // remove trailing zeros in fractional
            var frac = parts[1].replace(/0+$/,'');
            return parts[0] + ',' + frac;
        }

        function toSubmitValue(display){
            if(display === null || display === undefined || display === '') return '';
            var n = parseNumberString(display);
            if(isNaN(n)) return '';
            // Use dot as decimal separator for server
            return n.toString();
        }

        function initInput(el){
            // initial display formatting
            if(el.value) el.value = toDisplay(el.value);
            el.addEventListener('input', function(e){
                // allow typing numbers, dots and commas; don't reformat while typing caret position may jump
                // simple approach: format on blur
            });
            el.addEventListener('blur', function(e){
                el.value = toDisplay(el.value);
            });
            el.form && el.form.addEventListener('submit', function(){
                // replace with server-friendly numeric string (dot decimal)
                var hidden = document.createElement('input');
                hidden.type = 'hidden';
                hidden.name = el.name;
                hidden.value = toSubmitValue(el.value);
                el.disabled = true; // prevent double submission of the visible field
                el.form.appendChild(hidden);
            });
        }
        window.initThousandsInput = initInput;
        
        document.addEventListener('DOMContentLoaded', function(){
            document.querySelectorAll('.thousands-input').forEach(function(el){ initInput(el); });
        });
    })();
    </script>
</body>
</html>
