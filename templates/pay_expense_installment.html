{% extends "base.html" %}

{% block title %}Gider Taksidi Öde{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-7">
        <div class="card">
            <div class="card-header">
                <h4 class="fw-bold mb-0"><i class="fa-solid fa-cash-register me-2"></i>Gider Taksidi Öde</h4>
            </div>
            <div class="card-body p-4">
                <div class="alert alert-info">
                    <strong>Gider:</strong> {{ installment[4] }}<br>
                    <strong>Proje:</strong> {{ installment[5] }}<br>
                    <strong>Taksit Vadesi:</strong> {{ installment[1].strftime('%d.%m.%Y') }}<br>
                    <strong>Taksit Tutarı:</strong> {{ "%.2f"|format(installment[2]) }} ₺<br>
                    <strong>Kalan Borç:</strong> <span class="fw-bold text-danger">{{ "%.2f"|format(installment[2] - (installment[3] or 0)) }} ₺</span>
                </div>

                <form method="POST" action="{{ url_for('pay_expense_installment', installment_id=installment[0]) }}">
                    <div class="mb-3">
                        <label for="amount" class="form-label fw-semibold">Ödenecek Tutar (*)</label>
                        <input type="number" step="0.01" class="form-control" id="amount" name="amount" value="{{ installment[2] - (installment[3] or 0) }}" required>
                    </div>
                    <div class="mb-3">
                        <label for="payment_date" class="form-label fw-semibold">İşlem Tarihi (*)</label>
                        <input type="date" class="form-control" id="payment_date" name="payment_date" required>
                    </div>

                    <div class="mb-3">
                        <label class="form-label fw-semibold">Ödeme Yöntemi (*)</label>
                        <div>
                            <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="payment_method" id="method_nakit" value="nakit" checked><label class="form-check-label" for="method_nakit">Nakit</label></div>
                            <div class="form-check form-check-inline"><input class="form-check-input" type="radio" name="payment_method" id="method_cek" value="çek"><label class="form-check-label" for="method_cek">Çek</label></div>
                        </div>
                    </div>

                    <div id="check_fields" class="border p-3 rounded-3 mb-3" style="display: none;">
                        <h6 class="mb-3">Verilen Çek Bilgileri</h6>
                        <div class="row">
                            <div class="col-md-6 mb-3"><label for="check_due_date" class="form-label fw-semibold">Vade Tarihi (*)</label><input type="date" class="form-control" id="check_due_date" name="check_due_date"></div>
                             <div class="col-md-6 mb-3"><label for="check_bank_name" class="form-label fw-semibold">Banka Adı</label><input type="text" class="form-control" id="check_bank_name" name="check_bank_name"></div>
                            <div class="col-md-12"><label for="check_number" class="form-label fw-semibold">Çek Numarası</label><input type="text" class="form-control" id="check_number" name="check_number"></div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="description" class="form-label fw-semibold">Açıklama</label>
                        <textarea class="form-control" id="description" name="description" rows="2"></textarea>
                    </div>

                    <div class="d-flex justify-content-end mt-4">
                        <a href="{{ url_for('list_expenses', project_id=installment[6]) }}" class="btn btn-secondary me-2">İptal</a>
                        <button type="submit" class="btn btn-success">Ödemeyi Kaydet</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('payment_date').value = today;

        const checkFields = document.getElementById('check_fields');
        const checkDueDateInput = document.getElementById('check_due_date');
        
        document.querySelectorAll('input[name="payment_method"]').forEach(radio => {
            radio.addEventListener('change', function() {
                if (this.value === 'çek') {
                    checkFields.style.display = 'block';
                    checkDueDateInput.required = true;
                } else {
                    checkFields.style.display = 'none';
                    checkDueDateInput.required = false;
                }
            });
        });
    });
</script>
{% endblock %}
