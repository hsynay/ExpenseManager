{% extends "base.html" %}
{% block title %}Proje Finansal Raporları{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold"><i class="fa-solid fa-chart-line me-2 text-primary"></i> Proje Finansal Raporları</h2>
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline-secondary">
        <i class="fa-solid fa-arrow-left me-1"></i>Geri
    </a>
</div>

<div class="row g-4">
    {% if not project_summaries %}
        <div class="col-12 text-center text-muted p-5">
            <i class="fa-solid fa-folder-open fa-3x mb-3"></i>
            <p class="h5">Raporlanacak proje bulunamadı.</p>
        </div>
    {% else %}
        {% for s in project_summaries %}
        <div class="col-lg-6">
            <div class="card h-100 shadow-sm">
                <div class="card-header {% if s.project_type == 'normal' %}bg-primary{% else %}bg-success{% endif %} text-white fw-bold">
                    <i class="fa-solid {% if s.project_type == 'normal' %}fa-building{% else %}fa-users{% endif %} me-2"></i>
                    {{ s.project_name }} ({{ 'Normal' if s.project_type == 'normal' else 'Kooperatif' }})
                </div>
                <div class="card-body p-4">

                    {% if s.project_type == 'normal' %}
                    <h5 class="text-muted mb-3"><i class="fa-solid fa-sack-dollar text-success me-2"></i>Gelir Durumu</h5>
                    <ul class="list-group mb-3">
                        <li class="list-group-item d-flex justify-content-between">
                            Planlanan Toplam Gelir: <strong>{{ s.planned_revenue|thousands }} ₺</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            Ödenen Gelir: <strong class="text-success">{{ s.collected_revenue|thousands }} ₺</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            Kalan Gelir: <strong class="text-warning">{{ s.remaining_revenue|thousands }} ₺</strong>
                        </li>
                    </ul>

                    <div class="progress mb-3" style="height: 18px;">
                        <div class="progress-bar fw-bold" role="progressbar" style="width: {{ s.progress_percentage }}%;">
                            {{ "%.1f"|format(s.progress_percentage) }}%
                        </div>
                    </div>

                    <h5 class="text-muted mb-3"><i class="fa-solid fa-money-bill-transfer text-danger me-2"></i>Gider Durumu</h5>
                    <ul class="list-group mb-3">
                        <li class="list-group-item d-flex justify-content-between">
                            Toplam Gider: <strong>{{ s.total_expenses|thousands }} ₺</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            Ödenen Gider: <strong class="text-success">{{ s.paid_expenses|thousands }} ₺</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            Kalan Gider: <strong class="text-warning">{{ s.remaining_expenses|thousands }} ₺</strong>
                        </li>
                    </ul>

                    <hr>
                    <p class="fw-bold">Net Nakit Durumu:
                        <span class="fs-5 {% if s.net_cash_flow >= 0 %}text-success{% else %}text-danger{% endif %}">
                            {{ s.net_cash_flow|thousands }} ₺
                        </span>
                    </p>

                    {% else %}
                    <h5 class="text-muted mb-3"><i class="fa-solid fa-hand-holding-dollar text-primary me-2"></i>Üye Katkıları</h5>
                    <ul class="list-group mb-3">
                        <li class="list-group-item d-flex justify-content-between">
                            Toplam Katkı: <strong>{{ s.member_contributions|thousands }} ₺</strong>
                        </li>
                    </ul>

                    <h5 class="text-muted mb-3"><i class="fa-solid fa-receipt text-danger me-2"></i>Gider Durumu</h5>
                    <ul class="list-group mb-3">
                        <li class="list-group-item d-flex justify-content-between">
                            Toplam Gider: <strong>{{ s.total_expenses|thousands }} ₺</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            Ödenen Gider: <strong class="text-success">{{ s.paid_expenses|thousands }} ₺</strong>
                        </li>
                        <li class="list-group-item d-flex justify-content-between">
                            Kalan Gider: <strong class="text-warning">{{ s.remaining_expenses|thousands }} ₺</strong>
                        </li>
                    </ul>

                    <hr>
                    <p class="fw-bold">Kasa Bakiyesi:
                        <span class="fs-5 {% if s.cash_balance >= 0 %}text-success{% else %}text-danger{% endif %}">
                            {{ s.cash_balance|thousands }} ₺
                        </span>
                    </p>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    {% endif %}
</div>
{% endblock %}
