{% extends "base.html" %}

{% block title %}Çek Takibi{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-bold"><i class="fa-solid fa-money-check-dollar me-2 text-primary"></i>Çek Defteri</h2>
</div>

<div class="row g-4">
    <!-- ALINAN ÇEKLER KARTI -->
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h5 class="mb-0"><i class="fa-solid fa-arrow-down me-2"></i>Alınan Çekler (Müşteri Çekleri)</h5>
            </div>
            <div class="card-body table-responsive">
                <table class="table table-hover align-middle table-sm">
                    <thead>
                        <tr>
                            <th>Vade Tarihi</th>
                            <th>Müşteri</th>
                            <th>Banka / Çek No</th>
                            <th class="text-end">Tutar</th>
                            <th class="text-center">Durum</th>
                            <th class="text-center">İşlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for check in incoming_checks %}
                        <tr class="{% if check[6] == 'karsiliksiz' %}table-danger{% elif check[1] < today and check[6] == 'portfoyde' %}table-warning{% endif %}">
                            <td>{{ check[1].strftime('%d.%m.%Y') }}</td>
                            <td>{{ check[3] }}</td>
                            <td>{{ check[4] or '-' }} / {{ check[5] or '-' }}</td>
                            <td class="text-end fw-bold">{{ "%.2f"|format(check[2]) }} ₺</td>
                            <td class="text-center"><span class="badge bg-info">{{ check[6]|capitalize }}</span></td>
                            <td class="text-center">
                                <!-- === GÜNCELLEME: Dropdown yerine direkt butonlar === -->
                                {% if check[6] == 'portfoyde' %}
                                <div class="btn-group btn-group-sm">
                                    <form action="{{ url_for('update_check_status') }}" method="POST" class="d-inline">
                                        <input type="hidden" name="check_id" value="{{ check[0] }}">
                                        <input type="hidden" name="check_type" value="incoming">
                                        <input type="hidden" name="new_status" value="tahsil_edildi">
                                        <button type="submit" class="btn btn-outline-success">Tahsil Edildi</button>
                                    </form>
                                    <form action="{{ url_for('update_check_status') }}" method="POST" class="d-inline ms-1">
                                        <input type="hidden" name="check_id" value="{{ check[0] }}">
                                        <input type="hidden" name="check_type" value="incoming">
                                        <input type="hidden" name="new_status" value="karsiliksiz">
                                        <button type="submit" class="btn btn-outline-danger">Karşılıksız</button>
                                    </form>
                                </div>
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="6" class="text-center p-3">Portföyde müşteri çeki bulunmuyor.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- VERİLEN ÇEKLER KARTI -->
    <div class="col-lg-12">
        <div class="card">
            <div class="card-header bg-danger text-white">
                <h5 class="mb-0"><i class="fa-solid fa-arrow-up me-2"></i>Verilen Çekler (Firma Çekleri)</h5>
            </div>
            <div class="card-body table-responsive">
                <table class="table table-hover align-middle table-sm">
                    <thead>
                        <tr>
                            <th>Vade Tarihi</th><th>Tedarikçi</th><th>Banka / Çek No</th><th class="text-end">Tutar</th><th class="text-center">Durum</th><th class="text-center">İşlemler</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for check in outgoing_checks %}
                        <tr class="{% if check[1] < today and check[6] == 'verildi' %}table-warning{% endif %}">
                            <td>{{ check[1].strftime('%d.%m.%Y') }}</td>
                            <td>{{ check[3] }}</td>
                            <td>{{ check[4] or '-' }} / {{ check[5] or '-' }}</td>
                            <td class="text-end fw-bold">{{ "%.2f"|format(check[2]) }} ₺</td>
                            <td class="text-center"><span class="badge bg-secondary">{{ check[6]|capitalize }}</span></td>
                            <td class="text-center">
                                {% if check[6] == 'verildi' %}
                                <form action="{{ url_for('update_check_status') }}" method="POST" class="d-inline">
                                    <input type="hidden" name="check_id" value="{{ check[0] }}">
                                    <input type="hidden" name="check_type" value="outgoing">
                                    <input type="hidden" name="new_status" value="odendi">
                                    <button type="submit" class="btn btn-sm btn-outline-success">Ödendi İşaretle</button>
                                </form>
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                        </tr>
                        {% else %}
                        <tr><td colspan="6" class="text-center p-3">Verilmiş çek bulunmuyor.</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
